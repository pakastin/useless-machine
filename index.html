<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="main.css">
    <title>Useless machine</title>
  </head>
  <body>
    <div id="center">
      <div id="scene">
        <div id="toggle">
          <div id="toggle-area"></div>
          <div id="toggle-bg"></div>
          <div id="toggle-tip"></div>
        </div>
        <div id="robot">
          <div id="robot-arm"></div>
          <div id="robot-lid"></div>
        </div>
      </div>
    </div>
    <div id="link"><a href="https://github.com/pakastin/useless-machine" target="_blank">Source code</a></div>
  <script>
    const $robotLid = document.querySelector('#robot-lid');
    const $robotArm = document.querySelector('#robot-arm');
    const $toggleTip = document.querySelector('#toggle-tip');

    const $toggle = document.querySelector('#toggle');
    let wait = false;

    $toggle.onclick = () => {
      if (wait) {
        return;
      }
      wait = true;
      const rnd = Math.random() * 2000;
      const rnd2 = Math.random() * 1000;
      openTip(100);
      setTimeout(openLid, rnd + 100, 200);
      setTimeout(openArm, rnd + rnd2 + 200, 100);
      setTimeout(closeTip, rnd + rnd2 + 300, 100);
      setTimeout(closeArm, rnd + rnd2 + 400, 200);
      setTimeout(closeLid, rnd + rnd2 + 500, 200);
      setTimeout(() => wait = false, rnd + rnd2 + 500);
    }

    const openTip = (duration) => $toggleTip.animate([
      { transform: 'translate(0, 0)', backgroundColor: 'hsl(0deg, 80%, 55%)' }, 
      { transform: 'translate(100%, 0)', backgroundColor: 'hsl(120deg, 50%, 55%)' }
    ], { fill: 'both', duration });

    const closeTip = (duration) => $toggleTip.animate([
      { transform: 'translate(100%, 0)', backgroundColor: 'hsl(120deg, 50%, 55%)' }, 
      { transform: 'translate(0, 0)', backgroundColor: 'hsl(0deg, 80%, 55%)' }
    ], { fill: 'both', duration });

    const openLid = (duration) => $robotLid.animate([
      { backgroundColor: '#fff', transform: 'rotateY(0)' },
      { backgroundColor: '#ddd', transform: 'rotateY(2deg)' }
    ], { fill: 'both', duration });

    const closeLid = (duration) => $robotLid.animate([
      { backgroundColor: '#ddd', transform: 'rotateY(2deg)' },
      { backgroundColor: '#fff', transform: 'rotateY(0)' }
    ], { fill: 'both', duration });

    const openArm = (duration) => $robotArm.animate([
      { transform: 'translate(100%, 0)' },
      { transform: 'translate(0, 0)' }
    ], {
      fill: 'both',
      duration
    });

    const closeArm = (duration) => $robotArm.animate([
      { transform: 'translate(0, 0)' },
      { transform: 'translate(100%, 0)' }
    ], {
      fill: 'both',
      duration
    });

    </script>
  </body>
</html>
